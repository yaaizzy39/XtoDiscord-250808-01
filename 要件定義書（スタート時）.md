
```markdown
# 📦 要件定義書：Xポスト → Discord転送 Chrome拡張

## 🧩 プロジェクト名
XToDiscordExtension

---

## 🎯 概要

このChrome拡張は、**X（旧Twitter）上の各ポストにボタンを追加し、そのボタンを押すことで該当ポストを指定されたDiscord Webhookへ転送する**機能を提供します。

---

## 🧑‍💻 想定ユーザー

- Discordサーバーを運用しているユーザー
- Webhook URLの取得・設定ができるユーザー

---

## 🔐 前提・制約

- ユーザーが自前でDiscord Webhookを取得し、拡張機能に登録
- Webhook URLは外部送信されず、ローカルストレージに保存
- 対応サイトは `https://twitter.com/` および `https://x.com/`
- Chrome Manifest V3 準拠

---

## 📁 ディレクトリ構成（提案）

```

/XToDiscordExtension
├── manifest.json
├── content.js
├── popup.html
├── popup.js
├── styles.css
└── utils/
└── discord.js

````

---

## 🛠️ 機能要件

| ID  | 機能                         | 説明                                                                 | 実装ファイル              |
|-----|------------------------------|----------------------------------------------------------------------|---------------------------|
| F1  | ポスト検出                   | XのDOMから各ポストを検出し処理対象にする                            | content.js                |
| F2  | ボタン挿入                   | 各ポストに「Send to Discord」ボタンを追加                           | content.js                |
| F3  | ポスト情報の取得             | ボタン押下時にポストの本文・URL・ユーザー名を取得                   | content.js                |
| F4  | DiscordへのWebhook送信       | 抽出したポスト内容をWebhook経由でDiscordに送信                      | utils/discord.js          |
| F5  | Webhook設定UI                | ユーザーがWebhook URLを入力・保存できるUI                           | popup.html / popup.js     |
| F6  | ストレージ管理               | Webhook URLの保存・読み込み                                         | popup.js / content.js     |
| F7  | 成功/失敗通知表示            | 転送結果をユーザーに通知                                            | content.js                |

---

## 📤 Discord 送信フォーマット（Webhook Payload）

```json
{
  "embeds": [
    {
      "title": "New X Post Shared",
      "description": "<ポスト本文テキスト>",
      "url": "https://x.com/<username>/status/<post_id>",
      "footer": {
        "text": "Shared via Chrome Extension"
      }
    }
  ]
}
````

> 初期実装では画像送信は省略可。

---

## 🧷 DOM操作ガイドライン

* 各ポストは `article[role="article"]` 要素で表現されている
* 投稿本文、投稿者、ポストURLはDOMを解析して抽出
* `MutationObserver` を使用し、動的に読み込まれたポストにも対応

---

## 🔐 セキュリティ要件

* Webhook URLは `chrome.storage.local` に保存
* 外部送信は一切行わない（Discord以外）
* ポスト送信時に確認ダイアログを表示（必要であれば）

---

## 🧪 テスト項目（抜粋）

* [ ] Webhook URLが保存・読み込みできる
* [ ] 全てのポストにボタンが正しく追加される
* [ ] 抽出されたポスト情報が正確
* [ ] Discordに正しい形式で送信される
* [ ] エラー発生時に通知が出る
* [ ] 動的に読み込まれるポストにも対応する

---

## 🧩 ユーザーフロー

1. Chrome拡張をインストール
2. 拡張アイコンをクリックし、popup.htmlでWebhook URLを入力・保存
3. X（Twitter.com or x.com）を開く
4. 各ポストに「Send to Discord」ボタンが表示される
5. ボタンをクリック → Discordに転送される
6. 成功 or 失敗の通知が表示される

---

## 📌 Claude への指示例

Claude、上記のMarkdown形式の要件定義に従って、Chrome拡張（Manifest V3）を作成してください。
まずは以下の機能を実装してください：

* 各ポストへの「Send to Discord」ボタンの追加（DOM挿入）
* クリック時にポストの本文・URLを取得
* 取得したデータをDiscord Webhookに送信

必要に応じて、popup.html で Webhook URL の保存・取得機能も実装してください。

```

---

このマークダウンをClaudeに渡せば、内容を正しく理解し、コード生成にスムーズに取り掛かってくれるはずです。  
ご希望であれば、続けて**各ファイルのコードテンプレート**も提供できますか？
```
